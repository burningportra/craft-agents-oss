{
  "created_at": "2026-02-05T01:57:15.103123Z",
  "epic": {
    "data": {
      "branch_name": "fn-3-workspace-aware-tasks-onboarding-flow",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-05T01:53:19.446942Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [],
      "id": "fn-3-workspace-aware-tasks-onboarding-flow",
      "next_task": 1,
      "plan_review_status": "unknown",
      "plan_reviewed_at": null,
      "spec_path": ".flow/specs/fn-3-workspace-aware-tasks-onboarding-flow.md",
      "status": "open",
      "title": "Workspace-Aware Tasks & Onboarding Flow",
      "updated_at": "2026-02-05T01:54:26.076597Z"
    },
    "spec": "# Workspace-Aware Tasks & Onboarding Flow\n\n## Overview\n\nThe Tasks view currently resolves the project directory via `process.cwd()` with fallback to `workspace.rootPath` (see `TasksPage.tsx:41-61` and `AppShell.tsx:514-530`), meaning it looks at the app's own repo. This epic replaces that with an `activeProjectAtom` that points at a user-selected workspace directory, adds a sidebar workspace switcher, migrates UI state to per-workspace `.flow/ui-state.json`, and provides a 5-step onboarding wizard when `.flow/` doesn't exist.\n\n**Terminology note**: The existing `Workspace` type (`packages/core/src/types/workspace.ts:11-20`) represents an auth/sessions container. This epic's \"project\" concept is a filesystem directory registered for flow-next task management. We use \"project\" internally to avoid collision with the existing Workspace type, while the UI may display \"workspace\" to users.\n\n## Scope\n\n**In scope:**\n- `activeProjectAtom` \u2014 Jotai atom tracking `{ path, flowStatus, gitInfo? }` for the selected project directory\n- Replace `process.cwd()` / `workspace.rootPath` pattern in TasksPage + AppShell\n- Per-project UI state persistence to `.flow/ui-state.json` (gitignored, debounced 500ms writes)\n- Sidebar project switcher with colored avatars, health badges, add/remove actions\n- 5-step onboarding wizard (Welcome \u2192 Interactive Demo \u2192 Configure \u2192 Initialize \u2192 Create Epic + Celebrate)\n- Brief welcome banner for cloned repos with existing `.flow/`\n- Empty states and edge case handling (.flow/ deletion, no projects registered, monorepo)\n\n**Out of scope:**\n- Multi-workspace concurrent views (one active project at a time)\n- Cloud sync of .flow/ state\n- Linux chokidar fallback for FlowWatcher (deferred per `flow-watcher.ts:11`)\n- Changes to the existing `Workspace` auth type\n\n## Approach\n\n### State Architecture\n\n- **`activeProjectAtom`**: New Jotai atom holding `{ path: string, flowStatus: 'initialized' | 'needs-setup' | 'error', gitInfo?: { branch, remote, lastCommit } }`. Derives from a `registeredProjectsAtom` (persisted to app-level config). Uses `jotai-family` (`atomFamily`) for per-project derived atoms.\n- **Project registry**: Stored in `~/.craft-agent/projects.json` (or equivalent app-level config). Shape: `[{ path, name, addedAt }]`. On app launch, validate paths still exist.\n- **FlowBridge cache**: Already implemented as `Map<string, FlowBridge>` at `ipc.ts:2545-2585` \u2014 no changes needed to caching strategy. Wire `activeProjectAtom.path` through existing IPC channels.\n- **UI state persistence**: Replace 7+ global localStorage atoms (`tasks-state.ts:66-560`) with reads/writes to `.flow/ui-state.json`. Use FlowBridge for file I/O. Debounce writes at 500ms using existing persistence-queue pattern from `sessions/persistence-queue.ts`.\n\n### Workspace Switching\n\n- **Instant swap**: On project switch, load cached Jotai state immediately, refresh FlowBridge data in background.\n- **Lazy git info**: Fetch branch/remote/lastCommit via existing `GET_GIT_BRANCH` IPC (`types.ts:743`) only when project is selected (not on list load).\n- **State reset**: Use existing `resetTasksStateAtom` pattern (`tasks-state.ts:280-292`) on switch, then restore from `.flow/ui-state.json`.\n\n### Onboarding Wizard\n\n- **5-step modal**: Radix Dialog + Motion AnimatePresence `mode=\"wait\"` + spring config `{ type: 'spring', stiffness: 600, damping: 49 }` (matching existing `EpicCreationWizard.tsx` pattern).\n- **Step 1 (Welcome)**: Explain flow-next methodology with static content. Analyze README + package.json via IPC for contextual examples (graceful fallback to templates).\n- **Step 2 (Interactive Demo)**: Clickable walkthrough showing plan \u2192 work \u2192 review cycle with sample data.\n- **Step 3 (Configure)**: gitignore ui-state.json (default yes), default view mode preference. Skippable.\n- **Step 4 (Initialize)**: Run `flowctl init` via FlowBridge. Show progress spinner. On error: detailed dialog with error text, troubleshooting, retry/cancel. Skippable (defers init).\n- **Step 5 (Create Epic + Celebrate)**: Open existing `EpicCreationWizard`. On success: confetti via `canvas-confetti` (new dep, ~4KB gzipped). Navigate to new epic's kanban view.\n- **Skip behavior**: Steps 1-2 are informational and required. Steps 3-5 are skippable with sensible defaults.\n\n### Sidebar Switcher\n\n- New `ProjectSwitcher` component in sidebar area (`LeftSidebar.tsx`).\n- Each item: auto-generated colored avatar (initials + deterministic color from name hash), project name, truncated path, health badge.\n- Health badge: green check (`.flow/` exists + epic count), yellow warning (needs setup).\n- `+ Add Project` button triggers `OPEN_FOLDER_DIALOG` IPC (existing at `types.ts:631`). Auto-detect git root via `git rev-parse --show-toplevel`; if selected dir \u2260 git root, suggest git root.\n- Remove: unregister only (`.flow/` stays on disk).\n\n## Risks & Mitigations\n\n| Risk | Mitigation |\n|------|------------|\n| Dual \"workspace\" concept confusion | Use \"project\" internally; clear variable/type naming |\n| Migration of 7+ localStorage atoms | Task 2 handles migration with fallback reads from localStorage |\n| `.flow/ui-state.json` doesn't exist during onboarding | Use in-memory defaults until `.flow/` initialized |\n| Existing `OnboardingTutorial.tsx` overlap | Replace with new wizard; remove old 4-step spotlight tutorial |\n| `canvas-confetti` new dependency | Lightweight (~4KB gzip), no framework deps, web worker support |\n| FlowWatcher race on rapid project switching | Debounce watcher setup, tear down previous before starting new |\n\n## Quick commands\n\n```bash\n# Typecheck the electron app\ncd apps/electron && bun run typecheck\n\n# Lint check\ncd apps/electron && bun run lint\n\n# Build and start\ncd apps/electron && bun run start\n```\n\n## Acceptance\n\n- [ ] Tasks view uses `activeProjectAtom.path` instead of `process.cwd()`\n- [ ] Jotai atom tracks active project path + flow status + git info\n- [ ] FlowBridge instances use `activeProjectAtom.path` through existing cache\n- [ ] Sidebar shows project list with auto-generated avatars and health badges\n- [ ] `+ Add Project` opens native OS folder picker with git root auto-detection\n- [ ] Switching projects is instant (cached state swap, background refresh)\n- [ ] 5-step onboarding wizard shown when `.flow/` doesn't exist\n- [ ] Onboarding welcome step explains flow-next methodology\n- [ ] Interactive demo step shows plan \u2192 work \u2192 review cycle\n- [ ] Configuration step offers gitignore + default view preferences\n- [ ] Steps 1-2 required, steps 3-5 skippable\n- [ ] Step 5 reuses EpicCreationWizard, ends with confetti + summary\n- [ ] UI state persisted to `.flow/ui-state.json` (debounced 500ms, gitignored)\n- [ ] Per-project state restored on switch (open tabs, active tab, view mode)\n- [ ] First open of cloned repo shows brief project overview welcome\n- [ ] `.flow/` deletion detected via FlowWatcher, user prompted to re-initialize\n- [ ] No projects registered shows polished empty state with add project CTA\n- [ ] Error during init shows detailed dialog with troubleshooting + retry\n- [ ] Old `OnboardingTutorial.tsx` spotlight tutorial removed\n\n## References\n\n- Spec: `docs/specs/workspace-aware-tasks-onboarding.md`\n- FlowBridge cache: `apps/electron/src/main/ipc.ts:2545-2585`\n- FlowWatcher: `apps/electron/src/main/lib/flow-watcher.ts`\n- Task atoms: `apps/electron/src/renderer/atoms/tasks-state.ts`\n- Existing wizard: `apps/electron/src/renderer/components/tasks/EpicCreationWizard.tsx`\n- Existing tutorial: `apps/electron/src/renderer/components/tasks/OnboardingTutorial.tsx`\n- Existing empty state: `apps/electron/src/renderer/components/tasks/TasksEmptyState.tsx`\n- AppShell context: `apps/electron/src/renderer/context/AppShellContext.tsx:179-183`\n- Sidebar: `apps/electron/src/renderer/components/app-shell/LeftSidebar.tsx`\n- IPC channels: `apps/electron/src/shared/types.ts`\n- Workspace type: `packages/core/src/types/workspace.ts:11-20`\n- localStorage keys: `apps/electron/src/renderer/lib/local-storage.ts`\n"
  },
  "epic_id": "fn-3-workspace-aware-tasks-onboarding-flow",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:33.968897Z",
        "depends_on": [],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.1.md",
        "status": "todo",
        "title": "Active Project Atom & Path Resolution",
        "updated_at": "2026-02-05T01:55:06.014867Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.1",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.1 Active Project Atom & Path Resolution\n\n## Description\nCreate the foundational `activeProjectAtom` and replace all `process.cwd()` / `workspace.rootPath` project path resolution patterns with the new atom-driven approach. This is the foundation task \u2014 all other tasks depend on it.\n\n**Size:** M\n**Files:** `apps/electron/src/renderer/atoms/tasks-state.ts`, `apps/electron/src/renderer/pages/TasksPage.tsx`, `apps/electron/src/renderer/components/app-shell/AppShell.tsx`, `apps/electron/src/shared/types.ts`, `apps/electron/src/main/ipc.ts`, `apps/electron/src/preload/index.ts`\n\n## Approach\n\n- Create `activeProjectAtom` holding `{ path: string | null, flowStatus: 'initialized' | 'needs-setup' | 'error', gitInfo?: { branch, remote, lastCommit } }` in `tasks-state.ts`\n- Create `registeredProjectsAtom` (persisted to app config or localStorage) holding `[{ path, name, addedAt }]`\n- Add IPC channels: `FLOW_PROJECT_REGISTER`, `FLOW_PROJECT_UNREGISTER`, `FLOW_PROJECT_LIST`, `FLOW_PROJECT_CHECK_STATUS` (check if `.flow/` exists at path)\n- Implement main process handlers in `ipc.ts` for project registration and status checks\n- Add `GET_GIT_INFO` IPC to lazily fetch `{ branch, remote, lastCommit }` via `git rev-parse` commands when a project is selected\n- Replace the `process.cwd()` + fallback pattern in `TasksPage.tsx:41-61` \u2014 derive project path from `activeProjectAtom` instead\n- Replace the duplicate pattern in `AppShell.tsx:514-530`\n- Wire `activeProjectAtom.path` into all existing FlowBridge IPC calls that currently use the resolved `projectPath`\n- Existing FlowBridge cache at `ipc.ts:2545-2585` already handles per-path instances \u2014 just ensure the new atom's path flows through\n\n## Key context\n\n- The existing `Workspace` type at `packages/core/src/types/workspace.ts:11-20` is an auth/sessions container \u2014 use \"project\" naming to avoid collision\n- `useActiveWorkspace()` at `AppShellContext.tsx:179-183` provides the existing workspace concept \u2014 the new project atom is separate\n- `resetTasksStateAtom` at `tasks-state.ts:280-292` already handles state reset on workspace changes \u2014 extend for project switching\n- `OPEN_FOLDER_DIALOG` IPC channel already exists at `types.ts:631` \u2014 reusable for project registration\n## Acceptance\n- [ ] `activeProjectAtom` exists with `{ path, flowStatus, gitInfo? }` shape\n- [ ] `registeredProjectsAtom` persists project list across app restarts\n- [ ] IPC channels for project register/unregister/list/status-check are implemented\n- [ ] `GET_GIT_INFO` IPC lazily fetches branch, remote, lastCommit\n- [ ] `TasksPage.tsx` no longer uses `process.cwd()` \u2014 uses `activeProjectAtom.path`\n- [ ] `AppShell.tsx` duplicate pattern replaced with `activeProjectAtom.path`\n- [ ] All FlowBridge IPC calls receive path from `activeProjectAtom`\n- [ ] Selecting a project updates `activeProjectAtom` and triggers FlowBridge data refresh\n- [ ] App typechecks (`bun run typecheck` in `apps/electron`)\n- [ ] App lints clean (`bun run lint` in `apps/electron`)\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:39.472397Z",
        "depends_on": [
          "fn-3-workspace-aware-tasks-onboarding-flow.1"
        ],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.2.md",
        "status": "todo",
        "title": "Per-Project UI State Persistence",
        "updated_at": "2026-02-05T01:55:23.306443Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.2",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.2 Per-Project UI State Persistence\n\n## Description\nMigrate per-project UI state (open tabs, active tab, view mode) from global localStorage atoms to `.flow/ui-state.json` files. Each project gets its own persisted UI state that's auto-gitignored.\n\n**Size:** M\n**Files:** `apps/electron/src/renderer/atoms/tasks-state.ts`, `apps/electron/src/main/lib/flow-bridge.ts`, `apps/electron/src/main/ipc.ts`, `apps/electron/src/shared/types.ts`, `apps/electron/src/preload/index.ts`\n\n## Approach\n\n- Add `readUiState` and `writeUiState` methods to `FlowBridge` class at `flow-bridge.ts` for reading/writing `.flow/ui-state.json`\n- Add IPC channels: `FLOW_UI_STATE_READ`, `FLOW_UI_STATE_WRITE`\n- Replace these global localStorage atoms in `tasks-state.ts` with project-scoped state:\n  - `selectedEpicIdAtom` (L66) \u2192 `activeTab` in ui-state.json\n  - `openTabsAtom` (L78) \u2192 `openTabs` in ui-state.json\n  - `activeTabAtom` (L87) \u2192 `activeTab` in ui-state.json\n  - `viewModePerEpicAtomFamily` (L96) \u2192 `viewModePerEpic` in ui-state.json\n- Debounce writes at 500ms \u2014 follow the pattern from `sessions/persistence-queue.ts:` (debounced async writes)\n- On project switch: read `.flow/ui-state.json` for new project, hydrate atoms\n- When no `ui-state.json` exists (first open): auto-open the epic with the most in-progress tasks (query via FlowBridge)\n- Ensure `flowctl init` adds `ui-state.json` to `.flow/.gitignore`\n- Migration: on first load, if localStorage has values but `ui-state.json` doesn't exist, seed `ui-state.json` from localStorage then clear localStorage keys\n\n## Key context\n\n- `.flow/ui-state.json` shape: `{ \"openTabs\": [\"fn-1-my-epic\"], \"activeTab\": \"fn-1-my-epic\", \"viewModePerEpic\": { \"fn-1-my-epic\": \"kanban\" } }`\n- The `suggestionSidebarOpenAtom` (L538), `dismissedSuggestionsAtomFamily` (L548), `epicReviewPromptShownAtomFamily` (L560) can stay in localStorage \u2014 they're not per-project critical state\n- FlowBridge's write queue pattern at `flow-bridge.ts:36-44` ensures serialized writes \u2014 debounce on the renderer side, FlowBridge queues on the main side\n## Acceptance\n- [ ] `FlowBridge` has `readUiState()` and `writeUiState(state)` methods\n- [ ] IPC channels `FLOW_UI_STATE_READ` and `FLOW_UI_STATE_WRITE` implemented\n- [ ] `openTabs`, `activeTab`, `viewModePerEpic` are persisted to `.flow/ui-state.json`\n- [ ] Writes are debounced at 500ms\n- [ ] On project switch, UI state is restored from `.flow/ui-state.json`\n- [ ] First open with no `ui-state.json`: auto-opens most active epic\n- [ ] `ui-state.json` is in `.flow/.gitignore`\n- [ ] Migration from localStorage \u2192 `ui-state.json` works on first load\n- [ ] App typechecks and lints clean\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:39.627740Z",
        "depends_on": [
          "fn-3-workspace-aware-tasks-onboarding-flow.1"
        ],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.3",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.3.md",
        "status": "todo",
        "title": "Sidebar Project Switcher",
        "updated_at": "2026-02-05T01:55:39.218560Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.3",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.3 Sidebar Project Switcher\n\n## Description\nAdd a project switcher component to the sidebar that shows registered projects with colored avatars, health badges, and actions for adding/removing projects.\n\n**Size:** M\n**Files:** `apps/electron/src/renderer/components/app-shell/LeftSidebar.tsx`, new `apps/electron/src/renderer/components/app-shell/ProjectSwitcher.tsx`, `apps/electron/src/renderer/components/app-shell/AppShell.tsx`, `apps/electron/src/shared/types.ts`, `apps/electron/src/main/ipc.ts`\n\n## Approach\n\n- Create `ProjectSwitcher` component following existing sidebar patterns in `LeftSidebar.tsx`\n- Place it in the sidebar area near the Tasks navigation item\n- Each project item renders:\n  - Auto-generated colored avatar: 2-letter initials from project name + deterministic color from name hash (similar to pastanaga-angular's `hashCode % colorPalette.length` pattern)\n  - Project name (derived from directory name or package.json name)\n  - Directory path (truncated with tooltip for full path)\n  - Health badge: green check if `.flow/` exists (show epic count), yellow warning if needs setup\n- Click switches `activeProjectAtom` \u2014 should feel instant (cached state swap, background refresh)\n- `+ Add Project` button triggers existing `OPEN_FOLDER_DIALOG` IPC at `types.ts:631`\n  - After folder selection: run `git rev-parse --show-toplevel` to detect git root\n  - If selected dir \u2260 git root, show dialog suggesting git root instead\n  - Register project to `registeredProjectsAtom`\n- Remove project: context menu or button \u2192 unregister from atom (`.flow/` stays on disk)\n- Health badges: stale counts for inactive projects (only live-update active project via FlowWatcher)\n\n## Key context\n\n- `LeftSidebar.tsx` uses `SidebarItem` array pattern with expandable items and context menus \u2014 follow this\n- Existing Radix `DropdownMenu` and `ContextMenu` are already in dependencies\n- `OPEN_FOLDER_DIALOG` handler exists in `ipc.ts` \u2014 may need to extract project name from `package.json` in the selected directory\n- `useActiveWorkspace()` at `AppShellContext.tsx:179-183` is the existing auth workspace concept \u2014 project switcher is parallel to it\n## Acceptance\n- [ ] `ProjectSwitcher` component renders in sidebar\n- [ ] Each project shows colored avatar with initials + deterministic color\n- [ ] Each project shows name, truncated path, and health badge\n- [ ] Health badge shows green (initialized + epic count) or yellow (needs setup)\n- [ ] Clicking a project switches `activeProjectAtom` instantly\n- [ ] `+ Add Project` opens native folder picker\n- [ ] Git root auto-detection suggests repo root if subdirectory selected\n- [ ] Remove project unregisters without deleting `.flow/`\n- [ ] Only active project's epic count is live-updated\n- [ ] Component follows existing sidebar patterns\n- [ ] App typechecks and lints clean\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:40.069410Z",
        "depends_on": [
          "fn-3-workspace-aware-tasks-onboarding-flow.1"
        ],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.4",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.4.md",
        "status": "todo",
        "title": "Onboarding Wizard Shell & Steps 1-2",
        "updated_at": "2026-02-05T01:55:56.071370Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.4",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.4 Onboarding Wizard Shell & Steps 1-2\n\n## Description\nBuild the onboarding wizard modal shell and implement the first two steps: Welcome and Interactive Demo. These steps are required (not skippable) and introduce the user to the flow-next methodology.\n\n**Size:** M\n**Files:** new `apps/electron/src/renderer/components/tasks/OnboardingWizard.tsx`, `apps/electron/src/renderer/pages/TasksPage.tsx`, `apps/electron/src/shared/types.ts`, `apps/electron/src/main/ipc.ts`\n\n## Approach\n\n- Create `OnboardingWizard` component as a Radix Dialog modal\n- Follow the existing `EpicCreationWizard.tsx` pattern: Radix Dialog + Motion AnimatePresence `mode=\"wait\"` + spring config `{ type: 'spring', stiffness: 600, damping: 49 }`\n- Props: `open`, `onOpenChange`, `projectPath`, `onComplete`\n- Step navigation: prev/next buttons, step indicator dots, progress bar\n- **Step 1 (Welcome)**:\n  - Explain the flow-next plan \u2192 work \u2192 review methodology\n  - Static content with illustrations/icons (use existing lucide-react icons)\n  - Add IPC to read README.md + package.json from the project directory for contextual framing (e.g., \"Set up flow-next for <project-name>\")\n  - Graceful fallback: if files unreadable, use generic welcome text\n- **Step 2 (Interactive Demo)**:\n  - Show a mock kanban board or task flow visualization with sample data\n  - Clickable elements that highlight how epics, tasks, and the AI-assisted workflow operate\n  - Use the project name from step 1 in demo content\n  - Static animations using Motion for polish\n- Trigger in `TasksPage.tsx`: when `activeProjectAtom.flowStatus === 'needs-setup'`, show the wizard\n- Wire up step state management (current step, completed steps, can-skip logic)\n\n## Key context\n\n- Replace the existing `OnboardingTutorial.tsx` (4-step spotlight overlay) \u2014 the new wizard supersedes it. Removal happens in Task 6 to avoid breaking existing flow during development.\n- The wizard shell handles all 5 steps but this task only implements steps 1-2. Steps 3-5 are wired as placeholder/pass-through that Task 5 will fill in.\n- `EpicCreationWizard.tsx` is the closest existing pattern \u2014 study its Dialog + AnimatePresence setup\n## Acceptance\n- [ ] `OnboardingWizard` component renders as a Radix Dialog modal\n- [ ] Wizard has step navigation (prev/next, indicator dots, progress bar)\n- [ ] Step 1 shows flow-next methodology explanation with project context\n- [ ] Step 1 reads project name from README/package.json via IPC (with fallback)\n- [ ] Step 2 shows interactive demo with clickable elements\n- [ ] Step 2 uses project name in demo content\n- [ ] Steps 1-2 are not skippable (next only)\n- [ ] Wizard triggers when `activeProjectAtom.flowStatus === 'needs-setup'`\n- [ ] Wizard shell has placeholder slots for steps 3-5 (implemented in Task 5)\n- [ ] AnimatePresence transitions match existing wizard pattern\n- [ ] App typechecks and lints clean\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:40.646365Z",
        "depends_on": [
          "fn-3-workspace-aware-tasks-onboarding-flow.4"
        ],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.5",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.5.md",
        "status": "todo",
        "title": "Onboarding Wizard Steps 3-5",
        "updated_at": "2026-02-05T01:56:13.314851Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.5",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.5 Onboarding Wizard Steps 3-5\n\n## Description\nImplement the remaining onboarding wizard steps: Configure (3), Initialize (4), and Create Epic + Celebrate (5). These steps are skippable with sensible defaults.\n\n**Size:** M\n**Files:** `apps/electron/src/renderer/components/tasks/OnboardingWizard.tsx`, `apps/electron/src/shared/types.ts`, `apps/electron/src/main/ipc.ts`, `apps/electron/src/preload/index.ts`\n\n## Approach\n\n- **Step 3 (Configure)**:\n  - Toggle: gitignore `ui-state.json` (default: yes)\n  - Select: default view mode (list/kanban, default: kanban)\n  - Store preferences in a local config atom; apply when `.flow/` is initialized\n  - Skippable \u2014 uses defaults\n- **Step 4 (Initialize)**:\n  - Call `flowctl init` via FlowBridge IPC\n  - Show animated progress spinner during init\n  - On success: update `activeProjectAtom.flowStatus` to `'initialized'`, auto-advance to step 5\n  - On error: show detailed error dialog with full error text, troubleshooting steps, retry button, cancel button\n  - Skippable \u2014 but skipping means `.flow/` won't exist yet (user must init later)\n- **Step 5 (Create Epic + Celebrate)**:\n  - Open the existing `EpicCreationWizard` (Quick/Standard/Complex modes) inline or as nested dialog\n  - On epic creation success:\n    - `canvas-confetti` burst animation (new dependency, ~4KB gzip, no framework deps)\n    - Summary card showing what was created (epic name, task count)\n    - \"Get Started\" button closes wizard and navigates to the new epic's kanban view\n  - Skippable \u2014 closes wizard without creating an epic\n- Wire skip behavior: \"Skip\" button on steps 3-5 advances to next step (or closes wizard if step 5)\n- Add `FLOW_INIT` IPC channel if not already present (check existing channels first)\n\n## Key context\n\n- `EpicCreationWizard.tsx` has props `{ open, onOpenChange, workspaceRoot, epics, onEpicCreated, onOpenChat }` \u2014 reuse for step 5\n- `canvas-confetti` is recommended over `react-confetti` \u2014 lighter, supports web workers, no React dependency\n- FlowBridge already has methods for flowctl operations \u2014 may need a `runInit()` method or use existing exec pattern\n- The IPC channel `FLOW_EPIC_CREATE` from epic fn-1 may already exist \u2014 check and reuse\n## Acceptance\n- [ ] Step 3 shows configure options (gitignore toggle, default view mode)\n- [ ] Step 3 defaults are sensible (gitignore yes, kanban view)\n- [ ] Step 4 runs `flowctl init` and shows progress\n- [ ] Step 4 on success: updates flowStatus to 'initialized', auto-advances\n- [ ] Step 4 on error: shows detailed error dialog with retry/cancel\n- [ ] Step 5 opens EpicCreationWizard for epic creation\n- [ ] Step 5 on success: confetti animation + summary card + \"Get Started\" button\n- [ ] \"Get Started\" navigates to new epic's kanban view\n- [ ] Steps 3-5 are individually skippable\n- [ ] `canvas-confetti` added as dependency\n- [ ] App typechecks and lints clean\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-05T01:54:41.235792Z",
        "depends_on": [
          "fn-3-workspace-aware-tasks-onboarding-flow.1",
          "fn-3-workspace-aware-tasks-onboarding-flow.3"
        ],
        "epic": "fn-3-workspace-aware-tasks-onboarding-flow",
        "id": "fn-3-workspace-aware-tasks-onboarding-flow.6",
        "priority": null,
        "spec_path": ".flow/tasks/fn-3-workspace-aware-tasks-onboarding-flow.6.md",
        "status": "todo",
        "title": "Brief Welcome, Empty States & Edge Cases",
        "updated_at": "2026-02-05T01:56:30.229896Z"
      },
      "id": "fn-3-workspace-aware-tasks-onboarding-flow.6",
      "runtime": null,
      "spec": "# fn-3-workspace-aware-tasks-onboarding-flow.6 Brief Welcome, Empty States & Edge Cases\n\n## Description\nImplement the brief welcome banner for cloned repos, polished empty states, and edge case handling. Also remove the old `OnboardingTutorial.tsx` spotlight tutorial that's superseded by the new wizard.\n\n**Size:** M\n**Files:** `apps/electron/src/renderer/components/tasks/TasksEmptyState.tsx`, `apps/electron/src/renderer/pages/TasksPage.tsx`, `apps/electron/src/renderer/components/tasks/OnboardingTutorial.tsx` (remove), `apps/electron/src/renderer/lib/local-storage.ts`\n\n## Approach\n\n- **Brief welcome (cloned repo with `.flow/`)**:\n  - When a project has `.flow/` but user opens it for the first time (no `ui-state.json` yet):\n    - Show dismissible banner with: project name, epic count, task count, in-progress work summary\n    - Auto-open the most active epic (most in-progress tasks)\n    - Non-blocking \u2014 user can dismiss immediately\n  - Track dismissal per-project (store in `ui-state.json` or localStorage)\n- **Empty state (no projects)**:\n  - When `registeredProjectsAtom` is empty: show polished empty state in Tasks view\n  - Explain the project concept with illustration\n  - CTA: \"Add a Project\" button \u2192 triggers `+ Add Project` flow from sidebar switcher\n  - Follow existing `Empty` compound component pattern from `TasksEmptyState.tsx`\n- **`.flow/` deletion detection**:\n  - FlowWatcher at `flow-watcher.ts:99-105` already handles this\n  - On deletion: show banner in Tasks view \u2014 \".flow/ was removed. Re-initialize?\"\n  - Update `activeProjectAtom.flowStatus` to `'needs-setup'`\n  - \"Re-initialize\" triggers onboarding wizard or direct `flowctl init`\n- **Monorepo handling**: Only look for `.flow/` at project root (the registered path)\n- **Remove old tutorial**: Delete `OnboardingTutorial.tsx` and its references. Remove `KEYS.flowTasksOnboardingComplete` from localStorage registry.\n\n## Key context\n\n- `TasksEmptyState.tsx` uses the `Empty` compound component \u2014 follow same pattern for new empty states\n- FlowWatcher's `.flow/` deletion handling (`flow-watcher.ts:99-105`) falls back to parent directory watching\n- `OnboardingTutorial.tsx` has a 4-step spotlight overlay with localStorage persistence \u2014 all of this gets removed\n- `local-storage.ts` has the `KEYS` registry \u2014 clean up removed keys\n## Acceptance\n- [ ] Brief welcome banner shows for cloned repos (has `.flow/`, no `ui-state.json`)\n- [ ] Banner shows project name, epic/task counts, in-progress summary\n- [ ] Banner is dismissible and dismissal is persisted\n- [ ] Most active epic auto-opens on first visit\n- [ ] No-projects empty state shows with \"Add a Project\" CTA\n- [ ] Empty state follows existing `Empty` compound component pattern\n- [ ] `.flow/` deletion triggers banner with re-init option\n- [ ] `activeProjectAtom.flowStatus` updates to `'needs-setup'` on deletion\n- [ ] Old `OnboardingTutorial.tsx` is completely removed\n- [ ] `KEYS.flowTasksOnboardingComplete` removed from localStorage registry\n- [ ] Monorepo: `.flow/` only checked at registered project root\n- [ ] App typechecks and lints clean\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    }
  ]
}
